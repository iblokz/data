name: Deploy Docs

on:
  push:
    branches: [ master, main ]
    paths:
      - 'lib/**'
      - 'README.md'
      - 'docs/**'
      - '.github/workflows/docs.yml'

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Allow one concurrent deployment
concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Use Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20.x'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Generate API documentation
      run: npm run docs
    
    - name: Generate HTML docs with JSDoc
      run: npx jsdoc -c .jsdoc.json
    
    - name: Create docs site
      run: |
        mkdir -p _site
        cp README.md _site/
        cp API.md _site/
        
        # Create a simple index.html
        cat > _site/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>iblokz-data Documentation</title>
          <style>
            body {
              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
              max-width: 1200px;
              margin: 0 auto;
              padding: 2rem;
              line-height: 1.6;
              color: #333;
            }
            h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 0.5rem; }
            .links { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 2rem; }
            .link-card {
              padding: 1.5rem;
              border: 1px solid #e0e0e0;
              border-radius: 8px;
              text-decoration: none;
              color: inherit;
              transition: all 0.3s;
            }
            .link-card:hover {
              border-color: #3498db;
              box-shadow: 0 4px 12px rgba(52, 152, 219, 0.15);
              transform: translateY(-2px);
            }
            .link-card h2 { margin-top: 0; color: #3498db; }
            .link-card p { margin-bottom: 0; color: #666; }
            footer { margin-top: 3rem; padding-top: 2rem; border-top: 1px solid #e0e0e0; text-align: center; color: #666; }
          </style>
        </head>
        <body>
          <h1>üì¶ iblokz-data Documentation</h1>
          <p>Immutable data manipulation utilities for JavaScript</p>
          
          <div class="links">
            <a href="README.md" class="link-card">
              <h2>üìñ Getting Started</h2>
              <p>Installation, quick start guide, and usage examples</p>
            </a>
            
            <a href="API.md" class="link-card">
              <h2>üìö API Reference</h2>
              <p>Complete API documentation with all functions</p>
            </a>
            
            <a href="index.html" class="link-card">
              <h2>üîç JSDoc Browser</h2>
              <p>Interactive API browser generated from JSDoc</p>
            </a>
            
            <a href="https://github.com/iblokz/data" class="link-card">
              <h2>üíª GitHub Repository</h2>
              <p>Source code, issues, and contributions</p>
            </a>
            
            <a href="https://www.npmjs.com/package/iblokz-data" class="link-card">
              <h2>üì¶ npm Package</h2>
              <p>Install and view package information</p>
            </a>
          </div>
          
          <footer>
            <p>Built with ‚ù§Ô∏è by the iblokz-data team | MIT License</p>
          </footer>
        </body>
        </html>
        EOF
    
    - name: Setup Pages
      uses: actions/configure-pages@v4
    
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: '_site'
  
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

